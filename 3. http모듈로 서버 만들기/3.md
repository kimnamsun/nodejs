# 서버와 클라이언트

- 클라이언트가 서버로 요청(request)를 보냄
- 서버는 요청을 받아 처리 후, 클라이언트로 응답(response)을 보냄
- 요청과 응답은 http라는 프로토콜로 이루어짐. (마치 언어와 같다)

# http 서버 만들기

- http라는 모듈을 사용
- http 모듈에 존재하는 createServer 인자로 요청에 대한 콜백 함수를 넣을 수 있음. 요청이 들어올 때마다 매번 콜백 함수가 실행됨.
- listen을 하게 되면 터미널 하나를 잡아먹게 됨.
- 프로세스로 올리면 포트를 하나 차지하게 됨. (ex. 8080포트에서 프로세서로서 돌게 함.)
- 모든 서버는 포트가 존재한다.
- 기본적으로 서버 코드가 바뀌면 서버를 재시작해주어야 한다.

# localhost와 포트

- localhost는 컴퓨터 내부 주소 (도메인이 없는 사람들을 위해 제공됨), 외부에서 접근 불가
- 포트는 서버 내에서 프로세스를 구분하는 번호

```js
const http = require('http');

http
  .createServer((req, res) => {
    res.writeHead(200, { 'Content-Type': 'text/html; charset=utf-8' });
    res.write('<h1>Hello World</h1>');
    res.end('<p>hello server!</p>'); //<p>Hello Server!</p>을 클라이언트로 보낸 후 응답종료
  })
  .listen(8080, () => {
    console.log('8080번 포트에서 대기중');
  });
```

- `res.writeHead` : 응답에 대한 정보를 기록하는 메서드. 이 정보가 기록되는 부분을 헤더라고 함.
- `res.write` : 첫 번째 파라미터는 클라이언트로 보낼 데이터. 데이터가 기록되는 부분을 본문이라고 함.
- `res.end` : 응답을 종료하는 메서드

  ❓listen 메서드에 콜백 함수를 넣는 대신, 다음과 같이 서버에 listening 이벤트 리스너를 붙여도 됨 → 어떤 방식을 더 자주 사용하는지?

- html코드를 직접 적는 것 보다 다른 파일로 작성 후 fs 모듈을 통해 읽은 뒤 전송할 수 있다.
- HTTP Status Code : 브라우저는 서버에서 보내주는 상태 코드를 보고 요청이 성공했는지 실패했는지를 판단 (200번대, 300번대, 400번대, 500번대)
- 요청이 성공했든 실패했든 응답을 보내야함. 응답을 보내지 않으면 응답을 하염없이 기다리다가 Timeout(시간 초과) 처리함.

# REST API

- 서버의 자원을 정의하고 자원에 대한 주소를 지정하는 방법. 일종의 약속
- 주소는 보통 의미를 명확히 전달하기 위해 명사로 지정
- HTTP 요청 메서드 : GET / POST / PUT / PATCH / DELETE / OPTION → 메서드에 따라 분기 처리 가능
- REST를 따르는 서버를 ‘RESTful하다’고 표현
- req → request, res → response
- Header → 데이터들의 데이터
- 받은 데이터가 문자열 경우, JSON으로 만드는 JSON.parse 과정을 거쳐야함.
- req.on(’data’) : 리퀘스트에 데이터가 있을 때 데이터를 꺼내기 위한 작업

# vs GraphQL

- 오버패칭 :
- 언더패칭 :
- graphQL의 단점 (n+1 문제) :

# 쿠키

- 요청이 왔을 때 서버입장에서는 그 요청을 누가 보냈는지 알 수 없음
- 매 요청마다 서버에 동봉해서 보냄 (키=값의 쌍)
- 서버는 쿠키를 읽어서 누구인지를 파악
- writeHead Set-Cookie 로 쿠키를 넣어줄 수 있음.
- 한글을 사용할 경우에 encodeURIComponent를 반드시 사용해줘야함.
- 추가 옵션 설정 가능 → 만료시간을 직접 설정해줄 수 있음.
- 만료시간을 설정하지 않을 시 세션쿠키가 됨. (세션쿠키 : 브라우저를 끄는 순간에 쿠키가 사라짐)
- 브라우저가 알아서 유효기간이 지났는지 안지났는지를 판단해 유효기간이 지날 경우 보내지 않음.
- HttpOnly : 자바스크립트로 쿠키에 접근하지 못하게 설정. (보안을 위해)
- Path=/ → 슬래쉬 아래 주소에서는 모두 쿠키가 유효하다는 뜻

# 세션

- 중요 정보는 브라우저로 보내지 않고 서버에서 들고 있고 그 중요정보에 접속할 수 있는 키를 브라우저로 갖고 있게 하는 방법 (의미없는 데이터로 중요데이터)
- 실 서버에서는 세션을 직접 구현하지 말자 (express-session 사용)

# https, http2

- http에 ssl암호화모듈 추가
- 공개키 방식

# cluster

- 노드 프로세스를 한번에 여러개 돌릴 수 있다
- 멀티 프로세싱을 하기 위해 사용하는 모듈
